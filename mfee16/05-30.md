#### 本日課程目錄
1. [callback][]
2. [promise][]
3. [async & await][]
4. [OOP 摘要][]
5. [一些名詞解釋][]

<br>
<br>

<h3 id="para1">callback</h3>

<br>

callback是一種呼叫函式的方式。

當我們呼叫一個函式時，其實就是在call那個函式。

我們可以在呼叫函式時傳入參數再利用該參數和得到的結果呼叫另一個函式，  
我們也可以在呼叫函式的同時傳入另一個函式並執行他。

像這樣，在呼叫的函示中繼續呼叫另一個函式的行為就稱作**callback**。

<br>

>有些時候，我們可能會為了確保程式間的運行順序而呼叫了一個又一個的callback。  
>乍聽之下這樣的寫作方式沒什麼問題，然而這樣的習慣很容易讓你在無意間寫出過度複雜的回調函式嵌套，見下圖。

<br>

令人聞風喪膽的 **callback hell** (回調地獄)  
![image](https://user-images.githubusercontent.com/79037530/120286892-4e35fd00-c2f1-11eb-9d84-45a55ba170af.png)

這樣的結構不僅難以閱讀，也很容易在修改函式的某一環節時發生錯誤進而導致整個程式癱瘓，正所謂牽一髮而動全身。  

<br>
<br>

<h3 id="para2">promise</h3>

<br>

pormise是一個非同步執行的函式物件。

建立Promise物件時必須傳入一個函式。我們可以為這個函式設置兩個參數resolve和reject，並透過這兩個參數去呼叫Promise內建的函式`resolve()`和`reject()`。  
resolve()和reject()函式主要用來記錄主函式的運行結果。resolve負責紀錄成功的結果，reject負責紀錄失敗的結果。  

一般來說，我們會讓resolve和reject紀錄字串或物件等，並透過Promise物件提供的方法處理結果。  
不過Promise並沒有規定我們不能用這兩個函式傳遞程式碼。  

常用的Promise物件內建方法有then()和catch()。  
then()可以接受成功和錯誤訊息，catch()只能接受錯誤訊息。  
為了確保可閱讀性，慣例上我們習慣用then()處理成功訊息，用catch()處理錯誤訊息。  

我們利用Promise的內建方法確保方法()中的程式只會在Promise物件運行完畢後才被執行，就像callback。  

Promise物件有3種狀態，分別是
- 擱置（pending）：初始狀態，不是 fulfilled 與 rejected。
- 實現（fulfilled）：表示操作成功地完成。
- 拒絕（rejected）：表示操作失敗了。

Promise物件會在被定義的當下立刻被執行並根據正確執行與否將物件狀態轉為`{<fufilled>}`或是`{<rejected>}`。  
Promise物件會將運行的結果存入`resolve()`或`reject()`，並進入*microTask queue*進行佇列等待異部調用。  
利用Promise處理資料的方式和他的內建方法，我們得以用同步執行的`socking`特性去處理非同步函式取得的結果。  

試想我們在Promise物件裡面執行`setTimeout`指令，並用`then()`和`catch()`對執行結果做進一步的處理。  
由於Promise提供的內建方法只有在Promise實現後才會運作，我們可以確保方法中的程式在setTimeout運作完畢後才被執行。  

Promise的內建方法會在函式運作完畢後返回一個新的Promise物件。  
被返回的Promise物件會沿用前個Promise物件的狀態，並以前一個物件的執行結果為參數值。  
我們可以利用這樣的特性做串接多個then()，這樣的行為稱作*promise chain*。  
我們也可以在then()的結尾return指定的Promise物件進行類似callback的應用。  

promise chain不僅好閱讀也提供便利的錯誤處理機制以改善以往的callback hell。  
另一方面，他也讓我們能用stocking的方式去控制非同步函式的執行流程。  
由於他具備了種種優點，他成為被當今網路開發者廣泛使用的技術。


[callback]: https://chengen0612.github.io/mfee16/05-30#para1
[promise]: https://chengen0612.github.io/mfee16/05-30#para2
[async & await]: https://chengen0612.github.io/mfee16/05-30#para3
[OOP 摘要]: https://chengen0612.github.io/mfee16/05-30#para4
[一些名詞解釋]: https://chengen0612.github.io/mfee16/05-30#para5
